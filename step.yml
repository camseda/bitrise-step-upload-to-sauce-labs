#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  Upload to Sauce Labs
summary: |
  Upload an APK/AAB/IPA/ZIP artifact to Sauce Labs.
description: |
  Upload your build file to Sauce Labs for remote device testing.
  Requires an APK, AAB, IPA, or ZIP file within the workflow, Sauce Labs username, access key, and file name.
  You can optionally provide a file name, build path, or request url.

  Required fields are:
  - sauce_username
  - sauce_access_key

  Optional fields are:
  - sauce_app_name
  - artifact_path
  - data_center_url

  Note: If both `sauce_app_name` and `artifact_path` are missing, a valid .apk, .aab, .ipa, or .zip will attempt to be found.
  The script will automatically search using the default Env Vars (in descending order):
  - BITRISE_APK_PATH
  - BITRISE_AAB_PATH
  - BITRISE_IPA_PATH
  - BITRISE_XCARCHIVE_ZIP_PATH
  If both optional fields are null and no builds are found using the above, the workflow will fail.
website: https://github.com/camseda/bitrise-step-upload-to-sauce-labs
source_code_url: https://github.com/camseda/bitrise-step-upload-to-sauce-labs
support_url: https://github.com/camseda/bitrise-step-upload-to-sauce-labs/issues

project_type_tags:
  - ios
  - android

type_tags:
  - deploy

is_always_run: false
is_skippable: false
run_if: ""

toolkit:
  bash:
    entry_file: step.sh

inputs:
  - sauce_username: $SAUCE_USERNAME
    opts:
      title: Sauce Labs username
      summary: Your Sauce Labs username
      description: The username given to your Sauce Labs account.
      is_required: true
      is_sensitive: true
  - sauce_access_key: $SAUCE_ACCESS_KEY
    opts:
      title: Sauce Labs Access Key
      summary: Your Sauce Labs Access Key
      description: The secure key used to access your Sauce Labs account.
      is_required: true
      is_sensitive: true
  - sauce_app_name: $SAUCE_APP_NAME
    opts:
      title: Sauce Labs App Name
      summary: Your Sauce Labs application name and extension.
      description: |
        This is translated to the File Name in Sauce Labs (and must include the file extension).
        If `sauce_app_name` is included and `artifact_path` is null, the extension is used to search the workflow set it automatically.

        Sauce Lab's File Name can be used to activate a specific app with the `filename` flag in your Capabilities
        rather than using the File ID automatically generated on upload - `storage:filename=<fileName>.<ext>`.
        A JavaScript example would be: `caps['app'] = 'storage:filename=TestApplication.apk';`
      is_required: false
  - artifact_path:
    opts:
      title: The absolute path to your file
      summary: Leave empty to use an automatically generated artifact_path for an APK, AAB, IPA, or ZIP file
      description: |
        Generated automatically if `sauce_app_name` is set and contains a valid extension.
        If you don't supply `sauce_app_name`, provide an `artifact_path`, or upload a file format other than .apk, .aab, .ipa, or .zip, you will need to provide a value here.
      is_required: false
  - data_center_url:
    opts:
      title: Request / data center URL
      summary: App storage URL containing the location of your data center
      description: |
        If using the ES East or Europe data center, provide the desired URL for the POST request.
        This step will default to US West (https://api.us-west-1.saucelabs.com/v1/storage/upload) otherwise.
      is_required: false
